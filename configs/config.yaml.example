app:
  name: "QCAT"
  version: "2.0.0"
  environment: "development"

# 端口配置 - 统一管理所有服务端口
ports:
  # 应用服务端口
  qcat_api: 8082          # QCAT主应用API服务
  qcat_optimizer: 8081    # QCAT优化器服务

  # 数据库服务端口
  postgres: 5432          # PostgreSQL数据库
  redis: 6379            # Redis缓存

  # 监控服务端口
  prometheus: 9090       # Prometheus监控
  grafana: 3000         # Grafana监控面板
  alertmanager: 9093    # AlertManager告警

  # Web服务端口
  nginx_http: 80        # Nginx HTTP
  nginx_https: 443      # Nginx HTTPS
  frontend_dev: 3000    # 前端开发服务器

server:
  port: 8082
  read_timeout: 30s
  write_timeout: 30s
  max_header_bytes: 1048576

database:
  host: "localhost"
  port: 5432
  user: "postgres"
  password: "${DATABASE_PASSWORD}"
  dbname: "qcat"
  ssl_mode: "disable"
  max_open: 50
  max_idle: 10
  timeout: 5s
  conn_max_lifetime: 1h
  conn_max_idle_time: 15m

redis:
  enabled: true
  addr: "localhost:6379"
  password: "${REDIS_PASSWORD}"
  db: 0
  pool_size: 20
  min_idle_conns: 5
  max_retries: 3
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s

exchange:
  name: "binance"
  api_key: "${EXCHANGE_API_KEY}"
  api_secret: "${EXCHANGE_API_SECRET}"
  test_net: true
  base_url: "https://api.binance.com"
  websocket_url: "wss://stream.binance.com:9443"
  futures_base_url: "https://fapi.binance.com"
  futures_websocket_url: "wss://fstream.binance.com"
  rate_limit:
    enabled: true
    requests_per_minute: 1200
    burst: 100
  timeout: 30s
  retry_attempts: 3
  retry_delay: 1s

jwt:
  secret_key: "${QCAT_JWT_SECRET_KEY}"
  duration: 24h

monitoring:
  prometheus_enabled: true
  prometheus_path: "/metrics"
  alerts:
    high_latency_ms: 1000
    error_rate_percent: 5.0
    memory_usage_percent: 80.0
    cpu_usage_percent: 80.0
  health_check:
    interval_seconds: 30
    timeout_seconds: 10
    retry_count: 3
  metrics:
    collection_interval_seconds: 60
    retention_hours: 24
    aggregation_intervals:
      - "1m"
      - "5m"
      - "15m"
      - "1h"

cors:
  allowed_origins: ["*"]
  allowed_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
  allowed_headers: ["*"]
  allow_credentials: true

rate_limit:
  enabled: true
  requests_per_minute: 100
  burst: 20

# 安全与合规配置
security:
  # 密钥管理服务配置
  kms:
    master_key: "${SECURITY_KMS_MASTER_KEY}"
    key_rotation: 90d
    encryption_key: "${SECURITY_ENCRYPTION_KEY}"
  
  # 加密配置
  encryption:
    algorithm: "AES-256-GCM"
    key_size: 256
    key_rotation: 90d
    master_key: "${SECURITY_ENCRYPTION_MASTER_KEY}"
    public_key_path: "certs/public.pem"
    private_key_path: "certs/private.pem"
  
  # TLS配置
  tls:
    enabled: false
    cert_path: "certs/server.crt"
    key_path: "certs/server.key"
    min_version: 771  # TLS 1.2
    max_version: 772  # TLS 1.3
    cipher_suites:
      - 4865  # TLS_AES_128_GCM_SHA256
      - 4866  # TLS_AES_256_GCM_SHA384
      - 4867  # TLS_CHACHA20_POLY1305_SHA256
  
  # 网络安全配置
  network:
    rate_limit_enabled: true
    rate_limit_requests: 100
    rate_limit_window: 1m
    max_connections: 1000
    connection_timeout: 30s
    idle_timeout: 60s
    read_timeout: 30s
    write_timeout: 30s
    allowed_origins: ["*"]
    allowed_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
    allowed_headers: ["*"]
    exposed_headers: ["X-Total-Count"]
    allow_credentials: true
    max_age: 86400s
  
  # 审计日志配置
  audit:
    enabled: true
    log_level: "info"
    retention_days: 90
    encryption_enabled: true
  
  # 审批流程配置
  approval:
    enabled: true
    default_expiry: 7d
    min_approvers: 2
    auto_approve_roles: ["admin"]

# 日志配置
logging:
  level: "info"
  format: "json"
  output: "file"
  levels:
    default: "info"
    qcat: "debug"
    exchange: "info"
    strategy: "debug"
    optimizer: "info"
  output_config:
    console_enabled: true
    file_enabled: true
    file_path: "logs/qcat.log"
    max_file_size_mb: 100
    max_backup_files: 10
  max_size: 100
  max_backups: 10
  max_age: 30
  compress: true
  log_dir: "logs"

# 内存管理配置
memory:
  monitor_interval: 30s
  high_water_mark_percent: 80.0
  low_water_mark_percent: 60.0
  alert_threshold: 90.0
  enable_auto_gc: true
  gc_interval: 5m
  force_gc_threshold: 95.0
  max_memory_mb: 1024
  max_heap_mb: 512

# 网络重连配置
network:
  max_retries: 10
  initial_delay: 1s
  max_delay: 5m
  backoff_multiplier: 2.0
  jitter_factor: 0.1
  health_check_interval: 30s
  connection_timeout: 30s
  ping_interval: 30s
  pong_timeout: 10s
  max_consecutive_failures: 5
  alert_threshold: 3

# 健康检查配置
health:
  check_interval: 30s
  timeout: 10s
  retry_count: 3
  retry_interval: 5s
  degraded_threshold: 0.8
  unhealthy_threshold: 0.5
  alert_threshold: 3
  alert_cooldown: 5m

# 优雅关闭配置
shutdown:
  shutdown_timeout: 30s
  component_timeout: 10s
  signal_timeout: 5s
  enable_signal_handling: true
  force_shutdown_after: 60s
  log_shutdown_progress: true
  shutdown_order:
    - websocket_connections
    - strategy_runners
    - market_data_streams
    - order_managers
    - position_managers
    - risk_engine
    - optimizer
    - health_checker
    - network_manager
    - memory_manager
    - redis_cache
    - database
    - http_server

# 策略配置
strategy:
  default_mode: "paper"
  max_concurrent_strategies: 10
  strategy_timeout: 300s
  memory_limit_mb: 512
  sandbox_enabled: true
  backtest:
    enabled: true
    timeout: 3600s
    max_concurrency: 2
    data_retention_days: 90

# 优化器配置
optimizer:
  enabled: true
  timeout: 1800s
  max_iterations: 1000
  concurrency: 4
  algorithms:
    - "walk_forward"
    - "grid_search"
    - "bayesian"
  default_algorithm: "walk_forward"

# 市场数据配置
market_data:
  enabled: true
  cache_ttl: 60s
  batch_size: 1000
  update_interval: 1s
  symbols:
    - "BTCUSDT"
    - "ETHUSDT"
    - "BNBUSDT"
  data_types:
    - "klines"
    - "trades"
    - "orderbook"
    - "funding_rate"
    - "open_interest"

# 订单管理配置
order:
  timeout: 30s
  max_pending_orders: 100
  retry_attempts: 3
  retry_delay: 1s
  auto_cancel_timeout: 60s

# 风险管理配置
risk:
  enabled: true
  check_interval: 5s
  margin_call_threshold: 1.1
  liquidation_threshold: 1.0
  max_position_size: 100000
  max_leverage: 10
  max_drawdown: 0.1
  circuit_breaker_threshold: 0.15
  position_monitoring:
    enabled: true
    interval: 10s
    alert_threshold: 0.8

# 缓存配置
cache:
  ttl: 3600s
  max_size: 1000
  cleanup_interval: 300s
  compression_enabled: true
  encryption_enabled: false
