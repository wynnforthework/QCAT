# QCAT 本地运行指南

## 📋 系统要求

### 基础环境
- **Go**: 1.23+ (支持泛型和最新特性)
- **Node.js**: 20+ (React 19 + Next.js 15)
- **PostgreSQL**: 15+ (高性能数据存储)
- **Redis**: 7+ (缓存和消息队列)

### 推荐硬件配置
- **CPU**: 8核+ (并行计算需求)
- **内存**: 16GB+ (ML模型和大数据处理)
- **存储**: SSD 500GB+ (高性能I/O)
- **网络**: 稳定低延迟连接
- **GPU**: 可选 (深度学习加速)

## 🚀 快速开始

### 1. 克隆项目
```bash
git clone <repository-url>
cd QCAT
```

### 2. 安装依赖

#### 安装Go依赖
```bash
go mod download
go mod tidy
```

#### 安装前端依赖
```bash
cd frontend
npm install
cd ..
```

### 3. 配置环境

#### 复制配置文件
```bash
# 复制示例配置文件
cp configs/config.yaml.example configs/config.yaml
cp configs/optimizer.json configs/optimizer.json.example
```

#### 设置环境变量
```bash
# 数据库配置
export DB_HOST=localhost
export DB_PORT=5432
export DB_USER=postgres
export DB_PASSWORD=your_password
export DB_NAME=qcat

# Redis配置
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASSWORD=your_redis_password

# JWT配置
export JWT_SECRET=your_jwt_secret_key

# 交易所API配置（可选）
export BINANCE_API_KEY=your_api_key
export BINANCE_API_SECRET=your_api_secret
```

### 4. 启动数据库服务

#### 使用Docker启动PostgreSQL和Redis
```bash
# 启动数据库服务
docker-compose -f deploy/docker-compose.prod.yml up -d postgres redis
```

#### 或手动安装
```bash
# PostgreSQL
sudo apt-get install postgresql postgresql-contrib
sudo -u postgres createdb qcat
sudo -u postgres createuser qcat

# Redis
sudo apt-get install redis-server
sudo systemctl start redis-server
```

### 5. 初始化数据库
```bash
# 运行数据库迁移
go run cmd/qcat/main.go -migrate
```

### 6. 启动服务

#### 方式一：分别启动各个服务

**启动主服务器（后端API）**
```bash
go run cmd/qcat/main.go
```

**启动优化器服务（新终端）**
```bash
go run cmd/optimizer/main.go
```

**启动前端开发服务器（新终端）**
```bash
cd frontend
npm run dev
```

#### 方式二：使用一键启动脚本
```bash
# 使用提供的启动脚本
./scripts/start_local.sh
```

### 7. 验证服务状态

#### 检查后端API
```bash
curl http://localhost:8082/health
```

#### 检查优化器服务
```bash
curl http://localhost:8081/health
```

#### 检查前端
访问 http://localhost:3000

## 🔧 开发模式

### 热重载开发
```bash
# 后端开发（使用air进行热重载）
go install github.com/cosmtrek/air@latest
air

# 前端开发（Next.js自带热重载）
cd frontend
npm run dev
```

### 调试模式
```bash
# 后端调试
go run -race cmd/qcat/main.go

# 前端调试
cd frontend
npm run dev -- --inspect
```

## 🧪 测试

### 运行测试
```bash
# 运行所有测试
make test

# 运行单元测试
make test-unit

# 运行集成测试
make test-integration

# 运行E2E测试
make test-e2e

# 生成测试覆盖率报告
make test-coverage
```

### 性能测试
```bash
# 运行基准测试
make test-benchmark

# 运行性能测试
make test-performance
```

## 🐳 Docker开发环境

### 使用Docker Compose启动完整环境
```bash
# 启动所有服务
docker-compose -f deploy/docker-compose.prod.yml up -d

# 查看服务状态
docker-compose -f deploy/docker-compose.prod.yml ps

# 查看日志
docker-compose -f deploy/docker-compose.prod.yml logs -f
```

### 构建自定义镜像
```bash
# 构建后端镜像
docker build -f deploy/Dockerfile -t qcat-backend:latest .

# 构建前端镜像
docker build -f deploy/Dockerfile.frontend -t qcat-frontend:latest ./frontend
```

## 📊 监控和日志

### 查看系统状态
```bash
# 系统健康检查
curl http://localhost:8082/health

# 智能化控制器状态
curl http://localhost:8082/api/v1/intelligence/status

# AutoML引擎状态
curl http://localhost:8082/api/v1/automl/status

# 自愈系统状态
curl http://localhost:8082/api/v1/healing/status
```

### 查看日志
```bash
# 查看应用日志
tail -f logs/qcat.log

# 查看数据库日志
docker logs qcat-postgres

# 查看Redis日志
docker logs qcat-redis
```

## 🔍 故障排除

### 常见问题

#### 1. 数据库连接失败
```bash
# 检查PostgreSQL状态
sudo systemctl status postgresql

# 检查连接
psql -h localhost -U postgres -d qcat
```

#### 2. Redis连接失败
```bash
# 检查Redis状态
sudo systemctl status redis-server

# 测试Redis连接
redis-cli ping
```

#### 3. 端口被占用
```bash
# 查看端口占用
netstat -tlnp | grep :8082
netstat -tlnp | grep :8081
netstat -tlnp | grep :3000

# 杀死占用进程
sudo kill -9 <PID>
```

#### 4. 依赖安装失败
```bash
# 清理Go模块缓存
go clean -modcache

# 重新安装依赖
go mod download
go mod tidy
```

### 性能优化

#### 数据库优化
```bash
# 优化PostgreSQL配置
sudo nano /etc/postgresql/15/main/postgresql.conf

# 关键配置项
max_connections = 200
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB
```

#### Redis优化
```bash
# 优化Redis配置
sudo nano /etc/redis/redis.conf

# 关键配置项
maxmemory 1gb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
```

## 📚 相关文档

- [API文档](api_documentation.md)
- [架构分析](architecture_analysis.md)
- [部署指南](deployment_guide.md)
- [故障排除指南](troubleshooting_guide.md)
- [用户培训指南](user_training_guide.md)

## 🆘 获取帮助

- 📖 **文档**: [完整文档](docs/)
- 🐛 **Bug报告**: [GitHub Issues](https://github.com/wynnforthework/QCAT/issues)
- 💡 **功能建议**: [GitHub Discussions](https://github.com/wynnforthework/QCAT/discussions)

---

**🤖 QCAT v2.0 - 让AI为您的交易保驾护航！**
