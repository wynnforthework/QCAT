# QCAT 配置文件更新说明

## 概述

为了统一配置管理并确保敏感信息安全，我们对 `configs/` 目录中的所有配置文件进行了更新。

## 更新内容

### 1. 主配置文件

#### `configs/config.yaml`
- ✅ 已更新为统一的配置结构
- ✅ 使用环境变量占位符 `${VARIABLE_NAME}`
- ✅ 包含所有业务模块的配置

#### `configs/config.yaml.example`
- ✅ 创建了配置示例文件
- ✅ 与主配置文件保持一致
- ✅ 可以安全地提交到版本控制系统

### 2. 环境特定配置文件

#### `configs/production.yaml`
- ✅ 更新环境变量前缀为 `QCAT_`
- ✅ 使用环境变量占位符替换敏感信息
- ✅ 保持与主配置文件的一致性

#### `configs/test.yaml`
- ✅ 添加测试环境特定的环境变量
- ✅ 使用环境变量占位符
- ✅ 配置测试数据库和Redis

### 3. 功能模块配置文件

#### `configs/security.yaml`
- ✅ 更新加密密钥使用环境变量占位符
- ✅ 保持安全配置的完整性

#### `configs/cache.yaml`
- ✅ 更新Redis密码使用环境变量占位符
- ✅ 添加生产环境Redis主机配置

#### `configs/logger.yaml`
- ✅ 更新日志文件路径使用环境变量占位符
- ✅ 支持不同环境的日志配置

#### `configs/automation.yaml`
- ✅ 保持现有配置结构
- ✅ 无需敏感信息更新

#### `configs/intelligence.yaml`
- ✅ 保持现有配置结构
- ✅ 无需敏感信息更新

#### `configs/optimizer.yaml`
- ✅ 保持现有配置结构
- ✅ 无需敏感信息更新

#### `configs/algorithm.yaml`
- ✅ 保持现有配置结构
- ✅ 无需敏感信息更新

### 4. 环境变量模板

#### `deploy/env.example`
- ✅ 添加了所有新的环境变量
- ✅ 包含测试环境配置
- ✅ 包含缓存和日志配置
- ✅ 使用 `QCAT_` 前缀统一命名

## 环境变量命名规范

所有环境变量使用 `QCAT_` 前缀，采用大写字母和下划线分隔：

```
QCAT_[SECTION]_[SUBSECTION]_[KEY]
```

### 新增的环境变量

#### 安全配置
- `QCAT_SECURITY_VAULT_ENCRYPTION_KEY` - 保险库加密密钥

#### 日志配置
- `QCAT_LOGGER_FILE_PATH` - 主日志文件路径
- `QCAT_LOGGER_TEST_FILE_PATH` - 测试日志文件路径
- `QCAT_LOGGER_PROD_FILE_PATH` - 生产日志文件路径
- `QCAT_LOGGER_AUDIT_FILE_PATH` - 审计日志文件路径
- `QCAT_LOGGER_SECURITY_FILE_PATH` - 安全日志文件路径
- `QCAT_LOGGER_PERFORMANCE_FILE_PATH` - 性能日志文件路径

#### 缓存配置
- `QCAT_CACHE_REDIS_PASSWORD` - 缓存Redis密码
- `QCAT_CACHE_REDIS_HOST` - 缓存Redis主机

#### 测试环境配置
- `QCAT_TEST_DATABASE_HOST` - 测试数据库主机
- `QCAT_TEST_DATABASE_USER` - 测试数据库用户
- `QCAT_TEST_DATABASE_PASSWORD` - 测试数据库密码
- `QCAT_TEST_DATABASE_NAME` - 测试数据库名称
- `QCAT_TEST_REDIS_ADDR` - 测试Redis地址
- `QCAT_TEST_REDIS_PASSWORD` - 测试Redis密码

## 配置加载优先级

1. **环境变量** - 最高优先级
2. **环境变量文件 (.env)** - 本地开发环境
3. **配置文件 (config.yaml)** - 基础配置模板

## 安全注意事项

### 1. 敏感信息处理
- ✅ 所有敏感信息使用环境变量占位符
- ✅ 环境变量文件不应提交到版本控制系统
- ✅ 支持环境变量加密功能

### 2. 文件权限
建议设置适当的文件权限：
```bash
chmod 600 .env
chmod 600 configs/config.yaml
```

### 3. 环境变量加密
对于特别敏感的信息，可以使用加密的环境变量：
```bash
# 设置加密密钥
export QCAT_ENCRYPTION_KEY="your-encryption-key"

# 加密敏感信息
make config-encrypt TEXT="my-super-secret-password"

# 在 .env 文件中使用加密值
QCAT_DATABASE_PASSWORD=ENC:encrypted-value
```

## 使用方法

### 1. 初始化配置
```bash
# 生成环境变量模板
make config-generate

# 复制并编辑环境变量文件
cp .env.example .env
# 编辑 .env 文件，填入真实配置值
```

### 2. 验证配置
```bash
# 验证配置文件
make config-validate
```

### 3. 启动应用
```bash
# 启动本地开发环境
make start-local
```

## 配置文件状态

| 配置文件 | 状态 | 说明 |
|---------|------|------|
| `config.yaml` | ✅ 已更新 | 主配置文件，使用环境变量占位符 |
| `config.yaml.example` | ✅ 已创建 | 配置示例文件，可安全提交 |
| `production.yaml` | ✅ 已更新 | 生产环境配置，使用QCAT_前缀 |
| `test.yaml` | ✅ 已更新 | 测试环境配置，使用环境变量 |
| `security.yaml` | ✅ 已更新 | 安全配置，使用环境变量 |
| `cache.yaml` | ✅ 已更新 | 缓存配置，使用环境变量 |
| `logger.yaml` | ✅ 已更新 | 日志配置，使用环境变量 |
| `automation.yaml` | ✅ 无需更新 | 自动化配置，无敏感信息 |
| `intelligence.yaml` | ✅ 无需更新 | 智能配置，无敏感信息 |
| `optimizer.yaml` | ✅ 无需更新 | 优化器配置，无敏感信息 |
| `algorithm.yaml` | ✅ 无需更新 | 算法配置，无敏感信息 |
| `env.example` | ✅ 已更新 | 环境变量模板，包含所有配置 |

## 总结

所有配置文件已成功更新为统一的配置管理系统：

- **统一性**: 所有配置使用相同的命名规范和结构
- **安全性**: 敏感信息通过环境变量管理，支持加密
- **灵活性**: 支持多种配置方式和环境特定配置
- **可维护性**: 清晰的配置结构和完整文档

现在您可以安全、高效地管理QCAT的所有配置了！
